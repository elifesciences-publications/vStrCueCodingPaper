% UPDATES:
% Version 1.2 - JG initial import of text and figures from Google Drive, with edits

\documentclass[11pt]{article}

% packages
%\usepackage{natbib}
%\usepackage{doi}
%\usepackage{hyperref} 
\usepackage[natbibapa]{apacite}
%\usepackage{url}
\usepackage{graphicx}
\usepackage{setspace}
%\usepackage[nolists]{endfloat}
\usepackage{times}
\usepackage{ifthen}
\usepackage{parskip}
\usepackage[font={sf,small},labelfont=bf]{caption}
\usepackage{xspace}
\usepackage[pdftex]{color}
\usepackage{pdfcolmk}
\usepackage{fixltx2e} % for \textsubscript

% line numbers
\usepackage[left]{lineno}

% variable margins
\usepackage[left=2.5cm,top=2.5cm,bottom=3.5cm,right=2.5cm]{geometry}

% this helps figure placement
\renewcommand{\textfraction}{0.0}
\renewcommand{\topfraction}{1}
\renewcommand{\bottomfraction}{1}

% removes filenames from figures
\usepackage{grffile}

% spacing
\setlength{\parindent}{0in} 
\setlength{\parskip}{2\baselineskip}
\linespread{2}
\renewcommand{\baselinestretch}{1.66}\normalsize
%\setstretch{1.5}
%\captionsetup[figure]{font={stretch=1}}

% definitions
\newcommand{\bsf}[1]{\textbf{#1}}
\newcommand{\sem}{S.E.M.\@\xspace}
\newcommand{\degree}{$^o$\@\xspace}
\makeatletter
\setlength{\@fptop}{0pt}
\makeatother

% bib
% \bibliographystyle{apa}
\bibliographystyle{apacite}
\let\cite=\citep
\let\citeN=\citet
\let\citeNP=\citealt
\renewcommand{\bibfont}{\footnotesize}
\setlength{\bibsep}{2pt}

% remove urls from references
\usepackage{etoolbox}
\usepackage{environ}
\newtoggle{bibdoi}
\newtoggle{biburl}
\makeatletter

\undef{\APACrefURL}
\undef{\endAPACrefURL}
\undef{\APACrefDOI}
\undef{\endAPACrefDOI}

\long\def\collect@url#1{\global\def\bib@url{#1}}
\long\def\collect@doi#1{\global\def\bib@doi{#1}}
\newenvironment{APACrefURL}{\global\toggletrue{biburl}\Collect@Body\collect@url}{\unskip\unskip}
\newenvironment{APACrefDOI}{\global\toggletrue{bibdoi}\Collect@Body\collect@doi}{}

\AtBeginEnvironment{thebibliography}{
 \pretocmd{\PrintBackRefs}{%
    {\iftoggle{biburl}{\unskip\unskip doi:\bib@doi}{}}
}{}{}
}

\begin{document}
%change intext citations to ``%'', have to do it after begin document as commands get redefined
\renewcommand{\BBAB}{\BBAA}

{\Large\bf Persistent coding of outcome-predictive cue features in the
  rat nucleus accumbens.}

{\bf Authors}: Jimmie M.\ Gmaz\textsuperscript{1}, James
E.\ Carmichael\textsuperscript{1}, Matthijs A.\ A.\ van der
Meer\textsuperscript{1*}

\textsuperscript{1}Department of Psychological and Brain Sciences,
Dartmouth College, Hanover NH
03755\\ 

\textsuperscript{*}Correspondence should be addressed to MvdM,
Department of Psychological and Brain Sciences, Dartmouth College, 3
Maynard St, Hanover, NH 03755. E-mail: {\sffamily mvdm@dartmouth.edu}.

\textbf{Acknowledgments}: We thank Nancy Gibson, Martin Ryan and Jean
Flanagan for animal care, and Min-Ching Kuo and
Alyssa Carey for technical assistance. This work was supported by
Dartmouth College (Dartmouth Fellowship to JMG and JEC, and start-up funds to
MvdM) and the Natural Sciences and Engineering Research Council
(NSERC) of Canada (Discovery Grant award to MvdM, Canada Graduate
Scholarship to JMG).

\textbf{Conflict of Interest}: The authors declare no competing
financial interests.\\

\newpage
\linenumbers

\section*{Abstract}

The nucleus accumbens (NAc) is important for learning from feedback
and for biasing and invigorating behavior in response to cues that
predict motivationally relevant outcomes. NAc encodes outcome-related
cue features such as the magnitude and identity of reward. However,
little is known about how features of cues themselves are encoded.
We designed a decision making task where rats learned multiple sets of
outcome-predictive cues, and recorded single-unit activity in the NAc
during performance. We found that coding of various cue features
occurred alongside coding of expected outcome. Furthermore, this
coding persisted both during a delay period, after the rat made a
decision and was waiting for an outcome, and after the outcome was
revealed. Encoding of cue features in the NAc may enable contextual
modulation of ongoing behavior, and provide an eligibility trace of
outcome-predictive stimuli for updating stimulus-outcome associations
to inform future behavior.

\newpage

\section*{Introduction}

Theories of nucleus accumbens (NAc) function generally agree that this
brain structure contributes to motivated behavior, with some
emphasizing a role in learning from reward prediction errors (RPEs)
(\citeNP{Joel2002,Maia2009,Khamassi2012,Lee2012,Schultz2016,Averbeck2017};
see also the addiction literature on effects of drug rewards;
\citeNP{Kalivas2005,Hyman2006,Carelli2009}), and others a role in the
modulation of ongoing behavior through stimuli associated with
motivationally relevant outcomes \cite[invigorating,
  directing;][]{Nicola2010a,Salamone2012,Floresco2015}. These
proposals echo similar ideas on the functions of the neuromodulator
dopamine \cite{Maia2009,Berridge2012,Salamone2012,Schultz2016}, with
which the NAc is tightly linked functionally as well as anatomically
\cite{Cheer2007,Ikemoto2007,DuHoffmann2014,Takahashi2016}.

Much of our understanding of NAc function comes from studies of how
cues that predict motivationally relevant outcomes (e.g.\ reward)
influence behavior and neural activity in the NAc. Task designs that
associate such cues with rewarding outcomes provide a convenient
access point, eliciting conditioned responses such as sign-tracking and
goal-tracking \cite{hearst1974sign,Robinson2009},
pavlovian-instrumental transfer \cite{Estes1943,Rescorla1967} and
enhanced response vigor \cite{Niv2007,Nicola2010a}, which tend to be
affected by NAc manipulations
(\citeNP{Corbit2011,Flagel2011,Chang2012}; although not always
straightforwardly; \citeNP{Giertler2004,Chang2013}). Similarly,
analysis of RPEs typically proceeds by establishing an association
between a cue and subsequent reward, with NAc responses transferring
from outcome to the cue with learning
\cite{Schultz1997,Setlow2003,Roitman2005,Day2007a}.

Surprisingly, although substantial work has been done on the coding of
outcomes predicted by such cues
\cite{Schultz1992,Hollerman1998,Hassani2001,Cromwell2003,Setlow2003,Nicola2004,Roitman2005,Day2006,Roesch2009a,Saddoris2011,Goldstein2012,Lansink2012,Bissonette2013,McGinty2013,Atallah2014,Sugam2014,Cooch2015,West2016},
much less is known about how outcome-predictive cues themselves are
encoded in the NAc \cite[but see;][]{Sleezer2016}. This is an
important issue for at least two reasons. First, in reinforcement
learning, motivationally relevant outcomes are typically temporally
delayed relative to the cues that predict them. In order to solve the
problem of assigning credit (or blame) across such temporal gaps, some
trace of preceding activity needs to be maintained
\cite{sutton1998,Lee2012}. For example, if you become ill after eating
food X in restaurant A, depending on if you remember the identity of
the restaurant or the food at the time of illness, you may learn to
avoid all restaurants, restaurant A only, food X only, or the specific
pairing of X-in-A. Therefore, a complete understanding of what is
learned following feedback requires understanding what “trace” is
maintained. Since NAc is a primary target of dopamine signals interpretable
as RPEs, and NAc lesions impair RPEs related to timing, its activity
trace will help determine what can be learned when RPEs arrive
\cite{Ikemoto2007,McDannald2011,Hart2014,Hamid2016,Takahashi2016}. Similarly,
in a neuroeconomic framework, NAc is thought to represent a
domain-general subjective value singal for different offers
\cite{Peters2009,Levy2012,Bartra2013,Sescousse2015}; having a representation of
the offer itself alongside this value signal would provide a potential neural substrate for updating offer
value.

Second, for ongoing behavior, the relevance of cues typically depends
on “context”. In experimental settings, context may include the
identity of a preceding cue, spatial or configural arrangements
\cite{Holland1992,Bouton1993,Honey2014}, and unsignaled rules as
occurs in set shifting and other cognitive control tasks
\cite{Grant1948,cohen1992context,Floresco2006a,Sleezer2016}. In such
situations, the question arises how selective, context-dependent
processing of outcome-predictive cues is implemented. For instance, is
there a “gate” prior to NAc such that only currently relevant cues are
encoded in NAc, or are all cues represented in NAc but their current
values dynamically updated
\cite{Goto2008,Fitzgerald2014,Sleezer2016}. Representation of cue
identity would allow for context-dependent mapping of outcomes
predicted by specific cues.

Thus, both from a learning and a flexible performance perspective, it
is of interest to determine how cue identity is represented in the
brain, with NAc of particular interest given its anatomical and
functional position at the center of motivational systems. We sought
to determine whether cue identity is represented in the NAc, if cue
identity is represented alongside other motivationally relevant
variables, such as cue outcome, and if these representations are
maintained after a behavioral decision has been made (Figure
\ref{fig:schematic}). To address these questions, we recorded the
activity of NAc units as rats performed a task in which multiple,
distinct sets of cues predicted the same outcome.


 \begin{figure}[ht!]
\centering
\includegraphics[height=0.7\textheight]{Fig 1 - Schematic neural.pdf}
%\includegraphics[width=\textwidth]{Fig 1 - Schematic neural alt.pdf}
\caption{Schematic of potential coding strategies for cue feature coding employed by single units in the NAc across different cue features (A) and phases of a trial (B). \bsf{A}: Displayed are schematic PETHs illustrating putative responses to different cues under different hypotheses of how cue identity (light, sound) and outcome (reward-available, reward-unavailable) are coded. Left panel: Coding of identity is absent in the NAc. Top: Unit A encodes a motivationally relevant variable, such as expected outcome, similarly across other cue features, such as identity or physical location. Hypothetical plot is firing rate across time. L1+ (red) signifies a reward-available light cue, S1+ (navy blue) a reward-available sound cue, L2- (green) a reward-unavailable light cue, S2- (light blue) a reward-unavailable sound cue. Dashed line indicates onset of cue. Bottom: No units within the NAc discriminate their firing according to cue identity. Middle panel: Coding of identity occurs in a separate population of units from coding of other cue features such as expected outcome or physical location. Top: Same as left panel, with unit A discriminating between reward-available and reward-unavailable cues. Bottom: Unit B discriminates firing across stimulus modalities, depicted here as firing to light cues but not sound cues. Right panel: Coding of identity occurs in an overlapping population of cells with coding of other motivationally relevant variables. Hypothetical example demonstrating a unit that responds to reward-available cues, but firing rate is also modulated by the stimulus modality of the cue, firing most for the reward-available light cue. \bsf{B}: Displayed are schematic PETHs illustrating potential ways in which identity coding may persist over time. Left panel: Cue-onset triggers a transient response to a unit that codes for cue identity. Dashed lines indicate time of a behavioral or environmental event. 'Cue-ON' signifies onset of cue, 'NP' signifies when the rat holds a nosepoke at a reward receptacle, 'Out' signifies when the outcome is revealed, 'OFF' signifies when the cue turns off. Middle and right panel: Identity coding persists at other time points, shown here during a nosepoke hold period until outcome is revealed. Coding can either be maintained by a sequence of units (middle panel) or by the same unit as during cue-onset (right panel).}
\label{fig:schematic}
\end{figure} \clearpage

\addtocounter{figure}{-1}
\begin{figure} [t!]
  \caption{(Previous page.) \bsf{C}: Schematic pool of NAc units, illustrating the different possible outcomes for each of the analyses. {\it R} values represent the correlation between sets of recoded regression coefficients (see text for analysis details). Left panel: Cue identity is not coded (A: left panel), or is only transiently represented in response to the cue (B: left panel). Middle panel: Negative correlation (r $<$ 0) suggests that identity and outcome coding are represented by separate populations of units (A: middle panel), or identity coding is represented by distinct units across different points in a trial (B: middle panel). Red circles represents coding for one cue feature or point in time, blue circles for the other cue feature or point in time. Right panel: Identity and outcome coding (A: right panel), or identity coding at cue-onset and nosepoke (B: right panel) are represented by overlapping populations of units, shown here by the purple circles. The absence of a correlation (r $=$ 0) suggests that the overlap of identity and outcome coding, or identity coding at cue-onset and nosepoke, is expected by chance and that the two cue features, or points in time, are coded by overlapping but independent populations from one another. A positive correlation (r $>$ 0) implies a higher overlap than expected by chance, suggesting coding by a joint overlapping population. Note: The same hypotheses apply to other aspects of the environment when the cue is presented, such as the physical location of the cue, as well as other time epochs within the task, such as when the animal receives feedback about an approach.}
\end{figure}

\section*{Results}

\subsection*{Behavior}

Rats were trained to discriminate between cues signaling the
availability and absence of reward on a square track with four
identical arms for two distinct set of cues (Figure
\ref{fig:task}). During each session, rats were presented sequentially
with two behavioral blocks containing cues from different sensory
modalities, a light and a sound block, with each block containing a
cue that signalled the availability of reward (reward-available), and
a cue that signalled the absence of reward (reward-unavailable). To
maximize reward receipt, rats should approach reward sites on
reward-available trials, and skip reward sites on reward-unavailable
trials (see Figure \ref{fig:behav}A for an example learning
curve). All four rats learned to discriminate between the
reward-available and reward-unavailable cues for both the light and
sound blocks as determined by reaching significance ($p <$ .05) on a
daily chi-square test comparing approach behavior for reward-available
and reward-unavailable cues for each block, for at least three
consecutive days (range for time to criterion: 22 - 57
days). Maintenance of behavioral performance during recording sessions
was assessed using linear mixed effects models for both proportion of
trials where the rat approached the receptacle, and trial
length. Analyses revealed that the likelihood of a rat to make an
approach was influenced by whether a reward-available or
reward-unavailable cue was presented, but was not significantly
modulated by whether the rat was presented with a light or sound cue
(Percentage approached: light reward-available = 97\%; light
reward-unavailable = 34\%; sound reward-available = 91\%; sound
reward-unavailable 35\%; cue identity p $=$ .115; cue outcome p$<$
.001; Figure \ref{fig:behav}B). A similar trend was seen with the
length of time taken to complete a trial (Trial length: light
reward-available = 1.85 s; light reward-unavailable = 1.74 s; sound
reward-available = 1.91 s; sound reward-unavailable 1.78 s; cue
identity p $=$ .106; cue outcome p $<$ .001; Figure
\ref{fig:behav}C). Thus, during recording rats successfully
discriminated the cues according to whether or not they signaled the
availability of reward at the reward receptacle.

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 2 - Schematic task.pdf}
\caption{Schematic of behavioral task. \bsf{A}: To scale depiction of
  square track consisting of multiple identical T-choice points. At
  each choice point, the availability of 12\% sucrose reward at the
  nearest reward receptacle (light blue fill) was signaled by one of
  four possible cues, presented when the rat initiated a trial by
  crossing a photobeam on the track (dashed lines). Photobeams at the
  ends of the arms by the receptacles registered Nosepokes (solid
  lines). Rectangular boxes with yellow fill indicate location of LEDs
  used for light cues. Speakers for sound cues were placed underneath
  the choice points, indicated by magenta fill on track. Arrows
  outside of track indicate correct running direction. Circle in the
  center indicates location of pedestal during pre- and
  post-records. Scale bar is located beneath the track. \bsf{B}:
  Progression of a recording session. A session was started with a 5
  minute recording period on a pedestal placed in the center of the
  apparatus. Rats then performed the light and sound blocks of the cue
  discrimination task in succession for 100 trials each, followed by
  another 5 minute recording period on the pedestal. Left in figure
  depicts a light block, showing an example trajectory for a correct
  reward-available (approach trial; red) and reward-unavailable (skip
  trial; green) trial. Right in figure depicts a sound block, with a correct
  reward-available (approach trial; navy blue) and reward-unavailable
  (skip trial; light blue) trial. Ordering of the light and sound
  blocks was counterbalanced across sessions. Reward-available and
  reward-unavailable cues were presented pseudo-randomly, such that
  not more than two of the same type of cue could be presented in a
  row. Location of the cue on the track was irrelevant for behavior,
  all cue locations contained an equal amount of reward-available and
  reward-unavailable trials.}
\label{fig:task}
\end{figure} \clearpage

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 3 - Behavioral results.pdf}
\caption{Performance on the behavioral task. \bsf{A}. Example learning
  curves across sessions from a single subject (R060) showing the
  proportion of trials approached for reward-available (red line for light
  block, navy blue line for sound block) and reward-unavailable trials
  (green line for light block, light blue line for sound block) for
  light (top) and sound (bottom) blocks. Fully correct performance
  corresponds to an approach proportion of 1 for reward-available
  trials and 0 for reward-unavailable trials. Rats initially approach
  on both reward-available and reward-unavailable trials, and learn
  with experience to skip reward-unavailable trials. Red bars indicate days
  in which a rat statistically discriminated between reward-available
  and reward-unavailable cues, determined by a chi square test. Dashed
  line indicates time of electrode implant surgery. \bsf{B-C}: Summary
  of behavioral performance during recording sessions for each rat. \bsf{B}:
  Proportion of trials approached for each cue, averaged across all recording
  sessions and shown for each rat. Different columns indicate the different cues
  (reward-available (red) and reward-unavailable (green) light cues,
  reward-available (navy blue) and reward-unavailable (light blue)
  sound cues). Different symbols correspond to individual subjects;
  horizontal black line shows the mean. All rats learned to
  discriminate between reward-available and reward-unavailable cues,
  as indicated by the clear difference of proportion approached
  between reward-available ($\sim$90\% approached) and
  reward-unavailable cues ($\sim$30\% approached), for both blocks
  (see Results for statistics). \bsf{C}: Average trial length for each
  cue. Note that the time to complete a trial was comparable for light and sound cues.}
\label{fig:behav}
\end{figure} \clearpage

\subsection*{NAc encodes behaviorally relevant and irrelevant cue features}

We sought to address which parameters of our task were encoded by NAc
activity, specifically whether the NAc encodes aspects of
motivationally relevant cues not directly tied to reward, such as the
identity and location of the cue, and whether this coding is
accomplished by separate or overlapping populations (Figure
\ref{fig:schematic}A). To do this we recorded a total of 443 units
with $>$ 200 spikes in the NAc from 4 rats over 57 sessions (range: 12
- 18 sessions per rat) while they performed a cue discrimination task
(Table \ref{tbl1}). Units that exhibited a drift in firing rate over
the course of either block, as measured by a Mann-Whitney U test comparing
firing rates for the first and second half of trials within a block,
were excluded from further analysis, leaving 344 units for further
analysis. The activity of 133 (39\%) of these 344 units were modulated
by the cue, as determined by comparing 1 s pre- and post-cue activity with a Wilcoxon signed-rank test, with more showing a decrease in firing (n = 103) than an
increase (n = 30) around the time of cue-onset (Table
\ref{tbl1}). Within this group, 24 were classified as fast spiking interneurons (FSIs), while 109
were classified as medium spiny neurons (MSNs). Upon visual inspection, we observed several
patterns of firing activity, including units that discriminated firing
upon cue-onset across various cue conditions, showed sustained
differences in firing across cue conditions, had transient responses
to the cue, showed a ramping of activity starting at cue-onset, and
showed elevated activity immediately preceding cue-onset (Figure
\ref{fig:examples},supplement 1,supplement 2).

\begin{table}[p]
\centering
\setlength{\tabcolsep}{1 em} % for the horizontal padding
\begin{tabular}{l c  c c c c}

\bsf{Task parameter}                                 & \bsf{Total}        & \bsf{$\uparrow$ MSN}        & \bsf{$\downarrow$ MSN}        & \bsf{$\uparrow$ FSI}       & \bsf{$\downarrow$ FSI}\\
\hline
All units                       & 443        & 155         & 216          & 27          & 45\\
\hline
\textit{Rat ID}                       &         &       &          &          &\\
\hline
\hspace{3mm}R053                       & 145         & 51          & 79          & 4         & 11\\
\hline
\hspace{3mm}R056                       & 70         & 12          & 13         & 17          & 28\\
\hline
\hspace{3mm}R057   	          & 136         & 55          & 75          & 3          & 3\\
\hline
\hspace{3mm}R060                       & 92         & 37          & 49          & 3          & 3\\
\hline 
Analyzed units                       & 344        & 117         & 175         & 18         & 34\\
\hline
Cue modulated units                      & 133         &24          &85          & 6          &18\\
\hline
\hspace{3mm}\textit{GLM aligned to cue-onset}                       &         &       &          &          &\\
\hline
\hspace{6mm}Cue identity       & 42 (32$\%$)        & 9 (38$\%$)          & 25 (29$\%$)          & 0 (-)          & 8 (44$\%$)\\
\hline
\hspace{6mm}Cue location       & 55 (41$\%$)       & 11 (46$\%$)          & 33 (39$\%$)          & 3 (50$\%$)          & 8 (44$\%$)\\
\hline
\hspace{6mm}Cue outcome       & 26 (20$\%$)         & 5 (21$\%$)          & 15 (18$\%$)        & 1 (17$\%$)          & 5 (28$\%$)\\
\hline
\hspace{6mm}Approach behavior      & 32 (24$\%$)         & 8 (33$\%$)          & 19 (22$\%$)          & 2 (33$\%$)          & 3 (17$\%$)\\
\hline
\hspace{6mm}Trial length       & 22 (17$\%$)        & 5 (21$\%$)          & 14 (16$\%$)         & 0 (-)         & 3 (17$\%$)\\
\hline
\hspace{6mm}Trial number       & 42 (32$\%$)         & 11 (46$\%$)          & 20 (24$\%$)         & 1 (17$\%$)          & 10 (56$\%$)\\
\hline
\hspace{6mm}Trial historyl       & 8 (6$\%$)         & 1 (4$\%$)          & 5 (6$\%$)          & 0 (-)          & 1 (6$\%$)\\
\hline
\hspace{3mm}\textit{GLM aligned to nosepoke}                       &         &       &          &          &\\
\hline
\hspace{6mm}Cue identity       & 28 (21$\%$)         & 3 (13$\%$)          & 17 (20$\%$)          & 2 (33$\%$)          & 6 (33$\%$)\\
\hline
\hspace{6mm}Cue location       & 30 (23$\%$)         & 2 (8$\%$)          & 21 (25$\%$)          & 2 (33$\%$)          & 5 (28$\%$)\\
\hline
\hspace{6mm}Cue outcome       & 23 (17$\%$)        & 2 (8$\%$)          & 14 (16$\%$)        & 1 (17$\%$)          & 6 (33$\%$)\\
\hline
\hspace{3mm}\textit{GLM aligned to outcome}                       &         &       &          &          &\\
\hline
\hspace{6mm}Cue identity       & 25 (19$\%$)        & 4 (17$\%$)          & 15 (18$\%$)       & 2 (33$\%$)          & 4 (22$\%$)\\
\hline
\hspace{6mm}Cue location       & 31 (23$\%$)        & 5 (21$\%$)          & 23 (27$\%$)       & 0 (-)          & 3 (17$\%$)\\
\hline
\hspace{6mm}Cue outcome       & 34 (26$\%$)        & 6 (25$\%$)          & 15 (18$\%$)       & 4 (67$\%$)          & 9 (50$\%$)\\
\hline

\end{tabular}
\caption {Overview of recorded NAc units and their relationship to
  task variables at various time epochs. Percentage is relative to the
  number of cue-modulated units (n = 133).} \label{tbl1} 
\end{table}

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 4 - Neural examples.pdf}
\caption{Examples of cue-modulated NAc units influenced by different task parameters. \bsf{A}: Example of a cue-modulated NAc unit that showed an increase in firing following the cue, and exhibited identity coding. Top: rasterplot showing the spiking activity across all trials aligned to cue-onset. Spikes across trials are color-coded according to cue type (red: reward-available light; green: reward-unavailable light; navy blue: reward-available sound; light blue: reward-unavailable sound). Green and magenta bars indicate trial termination when a rat initiated the next trial or made a nosepoke, respectively. White space halfway up the rasterplot indicates switching from one block to the next. Dashed line indicates cue-onset. Bottom: PETHs showing the average smoothed firing rate for the unit for trials during light (red) and sound (blue) blocks, aligned to cue-onset. Lightly shaded area indicates standard error of the mean. Note this unit showed a larger increase in firing to sound cues. \bsf{B}: An example of a unit that was responsive to cue identity as in A, but for a unit that showed a decrease in firing to the cue. Note the sustained higher firing rate during the light block. \bsf{C-D}: Cue-modulated units that exhibited location coding. Each color in the PETHs represents average firing response for a different cue location. \bsf{C}: The firing rate of this unit only changed on arm 3 of the task. \bsf{D}: Firing rate decreased for this unit on all arms but arm 4. \bsf{E-F}: Cue-modulated units that exhibited outcome coding, with the PETHs comparing reward-available (red) and reward-unavailable (green) trials. \bsf{E}: This unit showed a slightly higher response during presentation of reward-available cues. \bsf{F}: This unit showed a dip in firing when presented with reward-available cues. \bsf{G-H}: Examples of cue-modulated units that encoded multiple cue features. \bsf{G}: This unit showed both identity and outcome coding. \bsf{H}: An example of a unit that coded for both identity and location.}
\label{fig:examples}
\end{figure} \clearpage

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 4 - Neural examples SUPP1.pdf}
\caption*{\bsf{Figure supplement 1:} Expanded examples of cue-modulated NAc units influenced by different
  task parameters for Figure \ref{fig:examples}A-D, showing firing rate breakdown by: cue type (top PETH), cue identity (top-middle PETH), cue location (bottom-middle PETH), and cue outcome (bottom PETH).}
\label{fig:examplesSUPP1}
\end{figure} \clearpage

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 4 - Neural examples SUPP2.pdf}
\caption*{\bsf{Figure supplement 2:} Expanded examples of cue-modulated NAc units influenced by different
  task parameters for Figure \ref{fig:examples}E-H, showing firing rate breakdown by: cue type (top PETH), cue identity (top-middle PETH), cue location (bottom-middle PETH), and cue outcome (bottom PETH).}
\label{fig:examplesSUPP2}
\end{figure} \clearpage

To characterize more formally whether these cue-modulated responses were influenced by various aspects of the task, we fit a sliding window generalized linear model (GLM) to the firing rate of each cue-modulated unit surrounding cue-onset, using a forward selection stepwise procedure for variable selection, a bin size of 500 ms for firing rate and a step size of 100 ms for the sliding window. Fitting GLMs to all trials within a session revealed that a variety of task parameters accounted for a significant portion of firing rate variance in NAc cue-modulated units (Figure \ref{fig:Q1}A,supplement 1,supplement 2, Table \ref{tbl1}). Notably, a significant proportion of units discriminated between the light and sound block ({\it identity coding}: $\sim$30\% of cue-modulated units, accounting for $\sim$5\% of firing rate variance) or the arms of the apparatus ({\it location coding}: $\sim$40\% of cue-modulated units, accounting for $\sim$4\% of firing rate variance) throughout the entire window surrounding cue-onset, whereas a substantial proportion of units discriminating between the common portion of reward-available and reward-unavailable trials ({\it outcome coding}: $\sim$25\% of cue-modulated units, accounting for $\sim$4\% of firing rate variance) was not observed until after the onset of the cue (z-score $>1.96$ when comparing observed proportion of units to a shuffled distribution obtained when shuffling the firing rates of each unit across trials before running the GLM), suggesting that the NAc encodes features of outcome-predictive cues in addition to expected outcome. 

 \begin{figure}[ht!]
\centering
\includegraphics[height=0.5\textheight]{Fig 5 - Q1.pdf}
\caption{Summary of influence of cue features on cue-modulated NAc units at time points surrounding cue-onset. \bsf{A}: Sliding window GLM (bin size: 500 ms; step size: 100 ms) demonstrating the proportion of cue-modulated units where cue identity (blue solid line), location (red solid line), and outcome (green solid line) significantly contributed to the model at various time epochs relative to cue-onset. Dashed colored lines indicate the average of shuffling the firing rate order that went into the GLM 100 times. Error bars indicate 1.96 standard deviations from the shuffled mean. Solid lines at the bottom indicate when the proportion of units observed was greater than the shuffled distribution (z-score $>$ 1.96). Points in between the two vertical dashed lines indicate bins where both pre- and post-cue-onset time periods were used in the GLM. \bsf{B}: Sliding window LDA (bin size: 500 ms; step size: 100 ms) demonstrating the classification rate for cue identity (blue solid line), location (red solid line), and outcome (green solid line) using a pseudoensemble consisting of the 133 cue-modulated units. Dashed colored lines indicate the average of shuffling the firing rate order that went into the cross-validated LDA 100 times. Solid lines at the bottom indicate when the classifier performance greater than the shuffled distribution (z-score $>$ 1.96). Points in between the two vertical dashed lines indicate bins where both pre- and post-cue-onset time periods were used in the classifier. \bsf{C-D}: Correlation matrices testing the presence and overlap of cue feature coding at cue-onset. \bsf{C}: Schematic outlining the possible outcomes for coding across cue features at cue-onset, generated by correlating the recoded beta coefficients from the GLMs and comparing to a shuffled distribution (see text for analysis details). Top left: coding is not present, therefore no comparison is possible. Top right: cue features are coded by separate populations of units. Displayed is a correlation matrix with each of the 9 blocks representing correlations for two cue features across the post-cue-onset time bins from the sliding window GLM, with green representing positive correlations (r $>$ 0), pink representing negative correlations (r $<$ 0), and white representing no correlation (r $=$ 0). X- and y-axis have the same axis labels, therefore the diagonal represents the correlation of a cue feature against itself at that particular time point (r $=$ 1). Here the large amount of pink in the off-diagonal elements suggests that coding of cue features occur separately from one another. Bottom left: Coding of cue features occurs in overlapping but independent populations of units, shown here by the abundance of white and relative lack of green and pink in the off-diagonal elements. Bottom right: Coding of cue features occurs in a joint overlapping population, shown here by the large amount of green in the off-diagonal elements. \bsf{D}: Correlation matrix showing the correlation among cue identity, location, and outcome coding surrounding cue-onset. The window of GLMs used in each block is from cue-onset to the 500 ms window post-cue-onset, in 100 ms steps. Each individual value is for a sliding window GLM within that range, with the scale bar contextualizing step size. Color bar displays relationship between correlation value and color. Colored square borders around each block indicate the result of a comparison of the mean correlation of a block to a shuffled distribution,}
\label{fig:Q1}
\end{figure} \clearpage

\addtocounter{figure}{-1}
\begin{figure} [t!]
  \caption{(Previous page.) with pink indicating separate populations (z-score $<$ -1.96), grey indicating overlapping but independent populations, and green indicating joint overlapping populations (z-score $>$ 1.96).}
\end{figure}

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 5 - SUPP GLM.pdf}
\caption*{\bsf{Figure supplement 1:} Summary of influence of various task parameters on cue-modulated NAc units at time points surrounding cue-onset. \bsf{A-C}: Sliding window GLM illustrating the proportion of cue-modulated units influenced by various predictors around time of cue-onset. \bsf{A}: Sliding window GLM (bin size: 500 ms; step size: 100 ms) demonstrating the proportion of cue-modulated units where cue identity (blue solid line), location (red solid line), and outcome (green solid line) significantly contributed to the model at various time epochs relative to cue-onset. Dashed colored lines indicate the average of shuffling the firing rate order that went into the GLM 100 times. Error bars indicate 1.96 standard deviations from the shuffled mean. Solid lines at the bottom indicate when the proportion of units observed was greater than the shuffled distribution (z-score $>$ 1.96). Points in between the two vertical dashed lines indicate bins where both pre- and post-cue-onset time periods were used in the GLM. \bsf{B}: Same as A, but for approach behavior and trial length. \bsf{C}: Same as A, but for trial number and trial history. \bsf{D-F}: Average improvement to model fit. \bsf{D}: Average percent improvement to R-squared for units where cue identity, location, or outcome were significant contributors to the final model for time epochs surrounding cue-onset. Shaded area around mean represents the standard error of the mean. \bsf{E}: Same as D, but for approach behavior and trial length. \bsf{F}: Same D, but for trial number and trial history.}
\label{fig:Q1SUPP1}
\end{figure} \clearpage

 \begin{figure}[ht!]
\centering
\includegraphics[height=0.3\textheight]{Fig 5 - SUPP scatter.pdf}
\caption*{\bsf{Figure supplement 2:} Scatter plot depicting comparison
  of firing rates for cue-modulated units across light and sound
  blocks. Crosses are centered on the mean firing rate, range
  represents the standard error of the mean. Colored crosses represents units that had cue
  identity as a significant predictor of firing rate variance in the GLM centered at cue-onset (blue
  are sound block preferring, red are light block preferring), whereas
  black crosses represent units where cue identity was not a
  significant predictor of firing rate variance. Diagonal dashed line
  indicates point of equal firing across blocks.}
\label{fig:Q1SUPP2}
\end{figure} \clearpage

To assess what information may be encoded at the population level, we trained a classifier on a pseudoensemble of the 133 cue-modulated units (Figure \ref{fig:Q1}B). Specifically, we used the firing rate of each unit for each trial as an observation, and different cue conditions as trial labels (e.g.\ light block, sound block). A linear discriminant analysis (LDA) classifier with 10-fold cross-validation could correctly predict a trial above chance levels for the identity and location of a cue across all time points surrounding cue-onset (z-score $>$ 1.96 when comparing classification accuracy of data versus a shuffled distribution), whereas the ability to predict whether a trial was reward-available or reward-unavailable (outcome coding) was not significantly higher than the shuffled distribution for the time point containing 500 ms of pre-cue firing rate, and increased gradually as a trial progressed, providing evidence that cue information is also present in the pseudoensemble level.

To quantify the overlap of cue feature coding we correlated recoded beta coefficients from the GLMs, assigning a value of `1' if a cue feature was a significant predictor for that unit and `0' if not, and compared the obtained correlations to the shuffled data generated for the GLMs (Figure \ref{fig:schematic}A,C, \ref{fig:Q1}C,D). This revealed that identity was coded separately from outcome (mean r  $=$ .009; -6.74 standard deviations from the shuffled mean), and independently from location (mean r  $=$ .097;  0.58 standard deviations from the shuffled mean), while location and outcome were coded by a joint population of units (mean r  $=$ .119;  2.23 standard deviations from the shuffled mean). Together, these findings show that various cue features are represented in the NAc at both the single-unit and pseudoensemble level, that identity is coded independently or in separate populations from location and outcome, respectively, and that location is coded jointly with outcome.

{\bf NAc units dynamically segment the task:}

Next, we sought to determine how coding of cue features evolved over
time. Two main possibilities can be distinguished (Figure \ref{fig:schematic}B);
a unit coding for a feature such as cue identity could remain
persistently active, or a progression of distinct units could activate
in sequence. To visualize the distribution of responses throughout our
task space and test if this distribution is modulated by cue features,
we z-scored the firing rate of each unit, plotted the normalized
firing rates of all units aligned to cue-onset, and sorted them
according to the time of peak firing rate (Figure
\ref{fig:tiling}). We did this separately for both the light and sound
blocks, and found a nearly uniform distribution of firing fields in
task space that was not limited to alignment to the cue (Figure
\ref{fig:tiling}A). Furthermore, to determine if this population level
activity was similar across blocks, we also organized firing during
the sound blocks according to the ordering derived from the light
blocks. This revealed that while there was some preservation of order,
the overall firing was qualitatively different across the two blocks,
implying that population activity distinguishes between light and
sound blocks. 

To control for the possibility that any comparison of
trials would produce this effect, we divided each
block into two halves and looked at the correlation of the average
smoothed firing rates across various combinations of these halves
across our cue-onset centered epoch to see if the across block comparisons were less correlated than the within block correlations. A linear mixed effects model
revealed that within block correlations (e.g. one half of light trials
vs other half of light trials) were higher and more similar than
across block correlations (e.g. half of light trials vs half of sound
trials) suggesting that activity in the NAc discriminates across
light and sound blocks (within block correlations = .383 (light), .379
(sound); across block correlations = .343, .338, .337, .348; within vs.\ within block comparison = p $=$ .934; within vs.\ across block comparisons = p $<$ .001). This process was repeated for cue location (Figure \ref{fig:tiling}B; within block
correlations = .369 (arm 1), .350 (arm 2); across block correlations =
.290, .286, .285, .291; within vs.\ within block comparison = p
$=$ .071; within vs.\ across block comparisons = p $<$ .001) and
cue outcome (Figure \ref{fig:tiling}C; within block correlations =
.429 (reward-available), .261 (reward-unavailable); across block
correlations = .258, .253, .255, .249; within vs.\ within block
comparison = p $<$ .001; within vs.\ across block comparisons =
p $<$ .001). Notably, the within condition comparison of reward-unavailable trials
was less correlated than reward-available trials, and more similar to
the across condition comparisons, potentially due do the greater
behavioral variability for the reward-unavailable trials. Additionally, given that the majority of our units showed an inhibitory response to the cue, we
also plotted the firing rates according to the lowest time in firing,
and again found some maintenance of order, but largely different
ordering across the two blocks (Figure \ref{fig:tiling} supplement 1). Together, this discriminative ``tiling'' suggests that NAc segmentation of the task is
qualitatively different even during those parts of the task not
immediately associated with a specific cue, action, or outcome.

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 6 - Task tiling.pdf}
\caption{Distribution of NAc firing rates across time surrounding cue-onset. Each panel shows normalized (z-score) peak firing rates for all recorded NAc
units (each row corresponds to one unit) as a function of time (time 0
indicates cue-onset), averaged across all trials for a specific cue type,
indicated by text labels. \bsf{A}, left: Heat plot showing smoothed normalized firing
activity of all recorded NAc units ordered according to the time of their peak
firing rate during the light block. Each row is a unit’s average activity
across time to the light block. Dashed line indicates cue-onset. Notice the
yellow band across time, indicating all aspects of visualized task space were
captured by the peak firing rates of various units. A, middle: Same units
ordered according to the time of the peak firing rate during the sound
block. Note that for both blocks, units tile time approximately uniformly with
a clear diagonal of elevated firing rates. A, right: Unit firing rates
taken from the sound block, ordered according to peak firing rate taken from
the light block. Note that a weaker but still discernible diagonal persists,
indicating partial similarity between firing rates in the two blocks. Color bar displays relationship between z-score and color. \bsf{B}: Same layout as in
A, except that the panels now compare two different locations on the track
instead of two cue modalities. As for the different cue modalities, NAc units
clearly discriminate between locations, but also maintain some similarity
across locations, as evident from the visible diagonal in the right panel. Two
example locations were used for display purposes; other location pairs showed
a similar pattern. \bsf{C}: Same layout as in A, except that panels now
compare reward-available and reward-unavailable trials. Overall, NAc units
``tiled" experience on the task, as opposed to being confined to specific task
events only. Units from all sessions and animals were pooled for this
analysis.}
\label{fig:tiling}
\end{figure} \clearpage

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 6 - SUPP Task tiling MIN.pdf}
\caption*{\bsf{Figure supplement 1:} Distribution of NAc firing rates across time surrounding cue-onset. Each panel shows normalized (z-score) minimum firing rates for all recorded NAc
units (each row corresponds to one unit) as a function of time (time 0
indicates cue-onset), averaged across all trials for a specific cue type,
indicated by text labels. \bsf{A}: Responses during
different stimulus blocks as in Figure \ref{fig:tiling}A, but with units ordered according to the
time of their minimum firing rate. \bsf{B}: Responses during trials on
different arms as in Figure \ref{fig:tiling}B, but with units ordered by their minimum firing
rate. \bsf{C}: Responses during cues signalling different outcomes as in Figure \ref{fig:tiling}C,
but with units ordered by their minimum firing rate. Overall, NAc units
``tiled" experience on the task, as opposed to being confined to specific task
events only. Units from all sessions and animals were pooled for this
analysis.}
\label{fig:tilingSUPP1}
\end{figure} \clearpage

{\bf NAc encoding of cue features persists until outcome:}

In order to be useful for credit assignment in reinforcement learning, a trace of the cue must be maintained until the outcome, so that information about the outcome can be associated with the outcome-predictive cue (Figure \ref{fig:schematic}B). Investigation into the post-approach period during nosepoke revealed units that discriminated various cue features, with some units showing discriminative activity at both cue-onset and nosepoke (Figure \ref{fig:NP_examples},supplement 1,supplement 2). To quantitatively test whether representations of cue features persisted post-approach until the outcome was revealed, we fit sliding window GLMs to the post-approach firing rates of cue-modulated units aligned to both the time of nosepoke into the reward receptacle, and after the outcome was revealed (Figure \ref{fig:Q2}A,B,supplement 1 A-D, Table \ref{tbl1}). This analysis showed that a variety of units discriminated firing according to cue identity ($\sim$20\% of cue-modulated units), location ($\sim$25\% of cue-modulated units), and outcome ($\sim$25\% of cue-modulated units), but not other task parameters, showing that NAc activity discriminates various cue conditions well into a trial.

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 7 - NP Neural examples.pdf}
\caption{Examples of cue-modulated NAc units influenced by cue features at time of nosepoke. \bsf{A}: Example of a cue-modulated NAc unit that exhibited identity coding at both cue-onset and during subsequent nosepoke hold. Top: rasterplot showing the spiking activity across all trials aligned to nosepoke. Spikes across trials are color coded according to cue type (red: reward-available light; green: reward-unavailable light; navy blue: reward-available sound; light blue: reward-unavailable sound). White space halfway up the rasterplot indicates switching from one block to the next. Black dashed line indicates nosepoke. Red dashed line indicates receipt of outcome. Bottom: PETHs showing the average smoothed firing rate for the unit for trials during light (red) and sound (blue) blocks, aligned to nosepoke. Lightly shaded area indicates standard error of the mean. Note this unit showed a sustained increase in firing to sound cues during the trial. \bsf{B}: An example of a unit that was responsive to cue identity at time of nosepoke but not cue-onset. \bsf{C-D}: Cue-modulated units that exhibited location coding, at both cue-onset and nosepoke (C), and only nosepoke (D). Each color in the PETHs represents average firing response for a different cue location. \bsf{E-F}: Cue-modulated units that exhibited outcome coding, at both cue-onset and nosepoke (E), and only nosepoke (F), with the PETHs comparing reward-available (red) and reward-unavailable (green) trials.}
\label{fig:NP_examples}
\end{figure} \clearpage

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 7 - NP Neural examples SUPP1.pdf}
\caption*{\bsf{Figure supplement 1:} Expanded examples of cue-modulated NAc units influenced by different cue features at both cue-onset and during subsequent nosepoke hold for Figure \ref{fig:NP_examples}A,C,E, showing firing rate breakdown by: cue type (top PETH), cue identity (top-middle PETH), cue location (bottom-middle PETH), and cue outcome (bottom PETH).}
\label{fig:NP_examplesSUPP1}
\end{figure} \clearpage

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 7 - NP Neural examples SUPP2.pdf}
\caption*{\bsf{Figure supplement 2:} Expanded examples of cue-modulated NAc units influenced by different cue features at time of nosepoke for Figure \ref{fig:NP_examples}B,D,F, showing firing rate breakdown by: cue type (top PETH), cue identity (top-middle PETH), cue location (bottom-middle PETH), and cue outcome (bottom PETH).}
\label{fig:NP_examplesSUPP2}
\end{figure} \clearpage

 \begin{figure}[ht!]
\centering
\includegraphics[height=0.7\textheight]{Fig 8 - Q2.pdf}
\caption{Summary of influence of cue features on cue-modulated NAc units at time points surrounding nosepoke and subsequent receipt of outcome. \bsf{A-B}: Sliding window GLM illustrating the proportion of cue-modulated units influenced by various predictors around time of nosepoke (A), and outcome (B). \bsf{A}: Sliding window GLM (bin size: 500 ms; step size: 100 ms) demonstrating the proportion of cue-modulated units where cue identity (blue solid line), location (red solid line), and outcome (green solid line) significantly contributed to the model at various time epochs relative to when the rat made a nosepoke. Dashed colored lines indicate the average of shuffling the firing rate order that went into the GLM 100 times. Error bars indicate 1.96 standard deviations from the shuffled mean. Solid lines at the bottom indicate when the proportion of units observed was greater than the shuffled distribution (z-score $>$ 1.96). Points in between the two vertical dashed lines indicate bins where both pre- and post-cue-onset time periods were used in the GLM. \bsf{B}: Same as A, but for time epochs relative to receipt of outcome after the rat got feedback about his approach. \bsf{C-F}: Correlation matrices testing the persistence of cue feature coding across points in time. \bsf{C}: Schematic outlining the possible outcomes for coding of a cue feature across various points in a trial, generated by correlating the recoded beta coefficients from the GLMs and comparing to a shuffled distribution (see text for analysis details). Top left: coding is not present, therefore no comparison is possible. Top right: a cue feature is coded by separate populations of units across time. Displayed is a correlation matrix with each of the 9 blocks representing correlations for a cue feature across time bins for two task events from the sliding window GLM, with green representing positive correlations (r $>$ 0), pink negative correlations (r $<$ 0), and white representing significant correlation (r $=$ 0). X- and y-axis have the same axis labels, therefore the diagonal represents the correlation of cue feature against itself at that particular time point (r $=$ 1). Here the large amount of pink in the off-diagonal elements suggests that coding of a cue feature is accomplished by separate populations of units across time.}
\label{fig:Q2}
\end{figure} \clearpage

\addtocounter{figure}{-1}
\begin{figure} [t!]
  \caption{(Previous page.) Bottom left: Coding of a cue feature across time occurs in overlapping but independent populations of units, shown here by the abundance of white and relative lack of green and pink in the off-diagonal elements. Bottom right: Coding of a cue feature across time occurs in a joint overlapping population, shown here by the large amount of green in the off-diagonal elements. \bsf{D}: Correlation matrix showing the correlation of units that exhibited identity coding across time points after cue-onset, nosepoke, and outcome receipt. The window of GLMs used in each block is from the onset of the task phase to the 500 ms window post-onset, in 100 ms steps. Each individual value is for a sliding window GLM within that range, with the scale bar contextualizing step size. Color bar displays relationship between correlation value and color. Colored square borders around each block indicate the result of a comparison of the mean correlation of a block to a shuffled distribution, with pink indicating separate populations (z-score $<$ -1.96), grey indicating overlapping but independent populations, and green indicating joint overlapping populations (z-score $>$ 1.96). \bsf{E-F}: Same as D, but for location and outcome coding, respectively.}
\end{figure}

 \begin{figure}[ht!]
\centering
\includegraphics[height=0.7\textheight]{Fig 8 - SUPP GLM.pdf}
\caption*{\bsf{Figure supplement 1:} Summary of influence of cue features on cue-modulated NAc units at time points surrounding nosepoke and subsequent receipt of outcome. \bsf{A-B}: Sliding window GLM illustrating the proportion of cue-modulated units influenced by various predictors around time of nosepoke (A), and outcome (B). \bsf{A}: Sliding window GLM (bin size: 500 ms; step size: 100 ms) demonstrating the proportion of cue-modulated units where cue identity (blue solid line), location (red solid line), and outcome (green solid line) significantly contributed to the model at various time epochs relative to when the rat made a nosepoke. Dashed colored lines indicate the average of shuffling the firing rate order that went into the GLM 100 times. Error bars indicate 1.96 standard deviations from the shuffled mean. Solid lines at the bottom indicate when the proportion of units observed was greater than the shuffled distribution (z-score $>$ 1.96). Points in between the two vertical dashed lines indicate bins where both pre- and post-cue-onset time periods were used in the GLM. \bsf{B}: Same as A, but for time epochs relative to receipt of outcome after the rat got feedback about his approach. \bsf{C-D}: Average improvement to model fit. \bsf{C}: Average percent improvement to R-squared for units where cue identity (blue solid line), location (red solid line), or outcome (green solid line) were significant contributors to the final model for time epochs relative to nosepoke. Dashed colored lines indicate the average of shuffling the firing rate order that went into the GLM 100 times. Shaded area around mean represents the standard error of the mean. \bsf{D}: Same C, but for time epochs relative to receipt of outcome. \bsf{E-F}: Correlation matrices testing the presence and overlap of cue feature coding at nosepoke (E) and outcome (F). \bsf{E}: Correlation matrix showing the correlation among identity, location, and outcome coding at nosepoke. Each of the 9 blocks represents correlations for two cue features across various nosepoke-centered time bins from the sliding window GLM, with green representing positive correlations (r $>$ 0), pink negative correlations (r $<$ 0), and grey representing no significant correlation (r $=$ 0). X- and y-axis have the same axis labels, therefore the diagonal represents the correlation of a cue feature against itself at that particular time point (r $=$ 1).}
\label{fig:Q2SUPP1}
\end{figure} \clearpage

\addtocounter{figure}{-1}
\begin{figure} [t!]
  \caption*{\bsf{Figure supplement 1:} (Previous page.) The window of GLMs used in each block is from the onset of the task phase to the 500 ms window post-onset, in 100 ms steps. Each individual value is for a sliding window GLM within that range, with the scale bar contextualizing step size. Colored square borders around each block indicate the result of a comparison of the mean correlation to a shuffled distribution, with pink indicating separate populations (z-score $<$ -1.96), grey indicating overlapping but independent populations, and green indicating joint overlapping populations (z-score $>$ 1.96). \bsf{F}: Same as E, but for time bins following outcome receipt. Color bar displays relationship between correlation value and color.}
\end{figure}

To determine whether NAc representations of cue features at nosepoke and outcome were encoded by a similar pool of units as during cue-onset, we correlated recoded beta coefficients from the GLMs for a cue feature across time points in the task, and compared the obtained correlations to the shuffled data generated for the GLMs (Figure \ref{fig:schematic}B,C,\ref{fig:Q2}C-F). This revealed that identity coding at cue-onset was separate from coding at nosepoke (mean r  $=$ .048; -2.18 standard deviations from the shuffled mean), independent from coding at outcome (mean r  $=$ .081; 1.02 standard deviations from the shuffled mean), while joint coding was observed between nosepoke and outcome (mean r  $=$ .147; 3.94 standard deviations from the shuffled mean). Applying this same analysis for cue location showed that location coding at cue-onset was independent from coding at nosepoke (mean r  $=$ .058; -1.41 standard deviations from the shuffled mean), while joint coding was observed with coding at outcome (mean r  $=$ .093; 2.03 standard deviations from the shuffled mean), as well as between nosepoke and outcome (mean r  $=$ .204; 9.35 standard deviations from the shuffled mean). Applying this analysis to cue outcome revealed that outcome coding at cue-onset was separate from both coding at nosepoke (mean r  $=$ -.040; -11.73 standard deviations from the shuffled mean), and coding at outcome (mean r  $=$ .025; -5.06 standard deviations from the shuffled mean), while joint coding was observed between nosepoke and outcome (mean r  $=$ .148; 3.15 standard deviations from the shuffled mean). Together, these findings show that the NAc maintains representations of cue features after a behavioral decision has been made with largely separate or independent pools of units, while a joint overlapping population is seen post-approach until the rat receives feedback about its decision.

To assess  overlap among cue features at nosepoke and outcome receipt, we applied the same recoded coefficient analysis (Figure \ref{fig:Q2} supplement 1 E,F). This revealed that at the time of nosepoke, identity was coded independently from location (mean r  $=$ .124; 1.00 standard deviations from the shuffled mean), and separately from outcome (mean r  $=$ .052; -3.19 standard deviations from the shuffled mean), and location and outcome were coded by an overlapping but independent population of units (mean r  $=$ .097;  -1.05 standard deviations from the shuffled mean); while at outcome, identity was coded independently from location (mean r  $=$ .085; -1.19 standard deviations from the shuffled mean), and separately from outcome (mean r  $=$ .039;  -4.20 standard deviations from the shuffled mean), and location and outcome were coded by a separate population of units (mean r  $=$ .004;  -7.22 standard deviations from the shuffled mean). 

To assess the tiling of units around outcome receipt, we aligned normalized peak firing rates to nosepoke onset (Figure \ref{fig:Q2} supplement 2). This revealed a clustering of responses around outcome receipt for all cue conditions where the rat would have received reward, in addition to the same trend of higher within- vs across-block correlations for cue identity (Figure \ref{fig:Q2} supplement 2 A,C; within block correlations = .560 (light), .541 (sound); across block correlations = .487, .481, .483, .486; within vs. within block comparison = p $=$ .112; within vs. across block comparisons = p $<$ .001) and cue location (Figure \ref{fig:Q2} supplement 2 B,E; within block correlations = .474 (arm 1), .461 (arm 2); across block correlations = .416, .402, .416, .415; within vs. within block comparison = p $=$ .810; within vs. across block comparisons = p $<$ .001), but not cue outcome (Figure \ref{fig:Q2} supplement 2 C,F; within block correlations = .620 (reward-available), .401 (reward-unavailable); across block correlations = .418, .414, .390, .408; within vs. within block comparison = p $<$ .001; within vs. across block comparisons = p $<$ .001), further reinforcing that the NAc segments the task and represents all aspects of task space.

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 8 - SUPP NP Task tiling.pdf}
\caption*{\bsf{Figure supplement 2:} Distribution of NAc firing rates across time surrounding nosepoke for approach
trials. Each panel shows normalized (z-score) firing rates for all recorded NAc units
(each row corresponds to one unit) as a function of time (time 0 indicates
nosepoke), averaged across all approach trials for a specific cue type,
indicated by text labels. \bsf{A-C}: Heat plots aligned to normalized peak firing rates. \bsf{A}, far left: Heat plot showing smoothed
normalized firing activity of all recorded NAc units ordered according to the
time of their peak firing rate during the light block. Each row is a unit’s
average activity across time to the light block. Black dashed line indicates
nosepoke. Red dashed line indicates reward delivery occurring 1 s after
nosepoke for reward-available trials. Notice the yellow band across time,
indicating all aspects of visualized task space were captured by the peak
firing rates of various units. A, middle: Same units ordered according to
the time of the peak firing rate during the sound block. Note that for both
blocks, units tile time approximately uniformly with a clear diagonal of
elevated firing rates, and a clustering around outcome receipt. A, right: Unit firing rates taken from the sound block, ordered according to peak
firing rate taken from the light block. Note that a weaker but still
discernible diagonal persists, indicating partial similarity between firing
rates in the two blocks. Color bar displays relationship between z-score and color. \bsf{B}: Same layout as in A, except
that the panels now compare two different locations on the track instead of
two cue modalities. As for the different cue modalities, NAc units clearly
discriminate between locations, but also maintain some similarity across
locations, as evident from the visible diagonal in the right panel. Two
example locations were used for display purposes; other location pairs showed
a similar pattern. \bsf{C}: Same layout as in A, except that panels now compare
correct reward-available and incorrect reward-unavailable trials. The disproportionate tiling around outcome receipt for reward-available, but not reward-unavailable
trials suggests encoding of reward receipt by NAc units. \bsf{D-F}: Heat plots aligned to normalized minimum firing rates. \bsf{D}: Responses during different stimulus blocks as in A, but with units ordered according to
the time of their minimum firing rate. \bsf{E}: Responses during trials on different arms as in B, but with units ordered by their minimum
firing rate. \bsf{F}: Responses during cues signalling different outcomes as in C, but with units ordered by their minimum firing
rate. Overall, NAc units ``tiled" experience on the task, as opposed to being
confined to specific task events only. Units from all sessions and animals
were pooled for this analysis.}
\label{fig:NP_tiling}
\end{figure} \clearpage

\section*{Discussion}

The main result of the present study is that NAc units encode not only the expected outcome of outcome-predictive cues, but also the identity of such cues (Figure \ref{fig:schematic}A). The population of units that coded for cue identity was statistically separate from the population coding for expected outcome at each major time point within a trial (i.e.\ overlap less than expected from chance), and independent from the population coding for the location of the cue (i.e.\ overlap as expected from chance, Figure \ref{fig:schematic}C). Importantly, this identity coding was maintained on approach trials by a distinct population of units both during a delay period where the rat held a nosepoke until the outcome was received, and immediately after outcome receipt (Figure \ref{fig:schematic}B,C). This information was also present at the population level, with a higher than chance classification accuracy for predicting the right cue condition using a pseudoensemble. Units that coded different cue features (identity, outcome, location) exhibited different temporal profiles as a whole, although across all recorded units a tiling of task structure was observed such that all points within our analyzed task space was accounted for by the ordered peak firing rates of all units. Furthermore, this tiling differed between various conditions with a cue feature, such as light versus sound blocks. We discuss these observations and their implications below.

{\bf Identity coding:}

Our finding that NAc units can discriminate between different outcome-predictive stimuli with similar motivational significance (i.e.\ encodes cue identity) expands upon an extensive rodent literature examining NAc correlates of conditioned stimuli \cite{Setlow2003,Nicola2004,Yun2004,Roitman2005,Day2006,Ambroggi2008,Ishikawa2008,Roesch2009a,Saddoris2011,Goldstein2012,Lansink2012,Bissonette2013,McGinty2013,Atallah2014,Sugam2014,Cooch2015,West2016,Dejean2017}. Perhaps the most comparable work in rodents comes from a study that found a subset of NAc units that modulated their firing for an odor when it predicted separate but equally valued rewards \cite{Cooch2015}. The present work is complementary to such {\it outcome identity} coding as it shows that NAc units encode {\it cue identity}, in addition to the reward it predicts (Figure \ref{fig:schematic}A). Similarly, \citeauthor{Setlow2003} (2003) paired distinct odor cues with appetitive or aversive outcomes, and found separate populations of units that encoded each cue. Furthermore, during a reversal they found that the majority of units switched their selectivity, arguing that the NAc units were tracking the motivational significance of these stimuli. Once again, our study was different in asking how distinct cues encoding the same anticipated outcome are encoded, suggesting that the NAc dissociates their representations at multiple levels of analysis (e.g.\ single-unit and population) even when the motivational significance of these stimuli is identical. A possible interpretation of this coding of cue identity alongside expected outcome is that these representations are used to associate reward with relevant features of the environment, so-called credit assignment in the reinforcement learning literature \cite{sutton1998}. A burgeoning body of human and non-human primate work has started to elucidated neural correlates of credit assignment in the PFC \cite{Chau2015,Akaishi2016,Asaad2017,Noonan2017}, and given the importance of cortical inputs in NAc associative representations it is possible that information related to credit assignment is relayed from the cortex to NAc \cite{Ishikawa2008,Cooch2015}.

Viewed within the neuroeconomic framework of decision making, functional magnetic resonance imaging (fMRI) studies have found support for NAc representations of {\it offer value}, a domain-general common currency signal that enables comparison of different attributes such as reward identity, effort, and temporal proximity \cite{Peters2009,Levy2012,Bartra2013,Sescousse2015}. Our study adds to a growing body of electrophysiological research that suggests the view of the NAc as a value center, while informative and capturing major aspects of NAc processing, neglects additional contributions of NAc to learning and decision making such as the offer (cue) identity signal reported here.

A different possible function for cue identity coding is to support contextual modulation of the motivational relevance of specific cues. A context can be understood as a particular mapping between specific cues and their outcomes: for instance, in context 1 cue A but not cue B is rewarded, whereas in context 2 cue B but not cue A is rewarded. Successfully implementing such contextual mappings requires representation of the cue identities. Indeed, \citeauthor{Sleezer2016} (2016) recorded NAc responses during the Wisconsin Card Sorting Task, a common set-shifting task used in both the laboratory and clinic, and found units that preferred firing to stimuli when a certain rule, or rule category was currently active. Further support for a modulation of NAc responses by strategy comes from an fMRI study that examined blood-oxygen-level dependent (BOLD) levels during a set-shifting task \cite{Fitzgerald2014}. In this task, participants learned two sets of stimulus-outcome contingencies, a visual set and an auditory set. During testing they were presented with both simultaneously, and the stimulus dimension that was relevant was periodically shifted between the two. Here, they found that bilateral NAc activity reflected value representations for the currently relevant stimulus dimension, and not the irrelevant stimulus. The current report of separate identity and outcome coding suggests the possibility that the relevance-gated value representations are generated by the combined activity of several different cell populations.

Our analyses were designed to eliminate several potential alternative interpretations to cue identity coding. Because the different cues were separated into different blocks, units that discriminated between cue identities could instead be encoding time or other slowly-changing quantities. We excluded this possible confound by excluding units that showed a drift in firing between the first and second half within a block. Additionally, we included time as a nuisance variable in our GLMs, to exclude firing rate variance in the remaining units that could be attributed to this confound. However, the possibility remains that instead of, or in addition to, stimulus identity, these units encode a preferred context, or even a macroscale representation of progress through the session. Indeed, encoding of the current strategy could be an explanation for the presence of pre-cue identity coding (Figure \ref{fig:Q1}A), as well as for the differential tiling of task structure across blocks observed in the current study (Figure \ref{fig:tiling}).

A different potential confound is that between outcome and action value coding as the rat was only rewarded for left turns. Our GLM analysis dealt with this by excluding firing rate variance accounted for by a predictor that represented whether the animal approached (left turn) or skipped (right turn) the reward port at the choice point, thus we were able to identity units that were modulated by the expected outcome of the cue after removing variance for potential action value coding. Another possible caveat is that NAc signals have been shown to be modulated by response vigor \cite{McGinty2013}; to detangle this from our results we included trial length (i.e.\ latency to arrival at the reward site) as a predictor in our GLMs, and found units with cue feature correlates independent of trial length.

An overall limitation of the current study is that rats were never presented with both sets of cues simultaneously, and were not required to switch strategies between multiple sets of cues (this was attempted in behavioral pilots, however animals took several days of training to successfully switch strategies). Additionally, our recordings were done during performance on the well-learned behavior, and not during the initial acquisition of the cue-outcome relationships when an eligibility trace would be most useful. Thus, it is unknown to what extent the cue identity encoding we observed is behaviorally relevant, although extrapolating data from other work \cite{Sleezer2016} suggests that cue identity coding would be modulated by relevance. Furthermore, NAc core lesions have been shown to impair shifting between different behavioral strategies \cite{Floresco2006a}, and it is possible that selectively silencing the units that prefer responding for a given modality or rule would impair performance when the animal is required to use that information, or artificial enhancement of those units would cause them to use the rule when it is the inappropriate strategy.

{\bf Encoding of position:}

Our finding that cue-modulated activity was influenced by cue location supports several previous reports \cite{Lavoie1994,Wiener2003,Mulder2005,Strait2016}. The NAc receives inputs from the hippocampus, and the communication of place-reward information across the two structures suggests that the NAc tracks locations associated with reward \cite{Tabuchi2000,Pennartz2004,Lansink2008,Lansink2009,VanderMeer2011,Lansink2016,Sjulson2017}. However, it is notable that in our task, location is explicitly uninformative about reward, yet coding of this uninformative variable persists. The finding of tiling of task space is in alignment with previous studies showing that NAc units can also signal progress through a sequence of cues and/or actions \cite{Shidara1998,Mulder2004,Khamassi2008,Berke2009,Lansink2012,Atallah2014}, is similar to observations in the basal forebrain \cite{Tingley2018}, and may represent a temporally evolving state value signal \cite{Pennartz2011,Hamid2016}. Given that the current task was pseudo-random, it is possible that the rats learned the structure of sequential cue presentation, and the neural activity could reflect this. However, this is unlikely as including a ‘trial history’ variable in the GLM analysis did not explain a significant amount of firing rate variance for the vast majority of units. In any case, NAc units on the present task continued to distinguish between different locations, even though location, and progress through a sequence, were explicitly irrelevant in predicting reward. We speculate that this persistent coding of location in NAc may represent a bias in credit assignment, and associated tendency for rodents to associate motivationally relevant events with the locations where they occur.

{\bf Implications:}

Maladaptive decision making, as occurs in schizophrenia, addiction, Parkinson's, among others, can result from dysfunctional RPE and value signals \cite{Frank2004,Gradin2011,Maia2011}. This view has been successful in explaining both positive and negative symptoms in schizophrenia, and deficits in learning from feedback in Parkinson's \cite{Frank2004,Gradin2011}. However, the effects of RPE and value updating are contingent upon encoding of preceding action and cue features, the eligibility trace \cite{sutton1998,Lee2012}. Value updates can only be performed on these aspects of preceding experience that are encoded when the update occurs. Therefore, maladaptive learning and decision making can result from not only aberrant RPEs but also from altered cue feature encoding. For instance, on this task the environmental stimulus that signaled the availability of reward was conveyed by two distinct cues that were presented in four locations. While in our current study, the location and identity of the cue did not require any adjustments in the animal’s behavior, we found coding of these features alongside the expected outcome of the cue that could be the outcome of credit assignment computations computed upstream \cite{Chau2015,Akaishi2016,Asaad2017,Noonan2017}. Identifying neural coding related to an aspect of credit assignment is important as inappropriate credit assignment could be a contributor to conditioned fear overgeneralization seen in disorders with pathological anxiety such as generalized anxiety disorder, post traumatic stress disorder, and obsessive-compulsive disorder \cite{Kaczkurkin2013,Lissek2014,Kaczkurkin2017}, and delusions observed in disorders such as schizophrenia, Alzheimer's and Parkinson's \cite{Kapur2003,Corlett2010}. Thus, our results provide a neural window into the process of credit assignment, such that the extent and specific manner in which this process fails in syndromes such as schizophrenia, obsessive-compulsive disorder, etc.\ can be experimentally accessed.

\section*{Methods}

{\bf Subjects:}

A sample size of 4 adult male Long-Evans rats (Charles River, Saint Constant, QC) from an apriori determined sample of 5 
were used as subjects (1 rat was excluded from the data set due to poor cell yield). Rats were individually housed with a 12/12-h
light-dark cycle, and tested during the light cycle. Rats were food
deprived to 85-90\% of their free feeding weight (weight at time of
implantation was 440 - 470 g), and water restricted 4-6 hours before
testing. All experimental procedures were approved by the the
University of Waterloo Animal Care Committee (protocol\# 11-06) and
carried out in accordance with Canadian Council for Animal Care (CCAC)
guidelines.

{\bf Overall timeline:}

Each rat was first handled for seven days during which they were
exposed to the experiment room, the sucrose solution used as a
reinforcer, and the click of the sucrose dispenser valves. Rats were
then trained on the behavioral task (described in the next section)
until they reached performance criterion. At this point they
underwent hyperdrive implantation targeted at the NAc. Rats were
allowed to recover for a minimum of five days before being retrained
on the task, and recording began once performance returned to
pre-surgery levels. Upon completion of recording, animals were gliosed,
euthanized and recording sites were histologically confirmed.

{\bf Behavioral task and training:}

The behavioral apparatus was an elevated, square-shaped track (100 x
100 cm, track width 10 cm) containing four possible reward locations
at the end of track ``arms'' (Figure \ref{fig:task}). Rats initiated a
{\it trial} by triggering a photobeam located 24 cm from the start of
each arm. Upon trial initiation, one of two possible light cues (L1,
L2), or one of two possible sound cues (S1, S2), was presented that
signaled the presence ({\it reward-available trial}, L1+, S1+) or
absence ({\it reward-unavailable trial}, L2-, S2-) of a 12\% sucrose
water reward (0.1 mL) at the upcoming reward site. A trial was
classified as an {\it approach trial} if the rat turned left at the
decision point and made a nosepoke at the reward receptacle (40 cm
from the decision point), while trials were classified as a {\it skip
trial} if the rat instead turned right at the decision point and
triggered the photobeam to initiate the next trial. A trial was labeled
{\it correct} if the rat approached (i.e.\ nosepoked) on
reward-available trials, and skipped (i.e.\ did not nosepoke) on
reward-unavailable trials. On reward-available trials there was a 1
second delay between a nosepoke and subsequent reward delivery. {\it
Trial length} was determined by measuring the length of time from
cue-onset until nosepoke (for approach trials), or from cue-onset
until the start of the following trial (for skip trials). Trials could
only be initiated through clockwise progression through the series of
arms, and each entry into the subsequent arm on the track counted as a
trial. Cues were present until 1  second after outcome receipt on approach trials, and until initiating the following trial on skip trials.

Each session consisted of both a {\it light block} and a {\it sound block} with
100 trials each. Within a block, one cue signaled reward was available on that
trial (L1+ or S1+), while the other signaled reward was not available (L2- or
S2-). Light block cues were a flashing white light, and a constant yellow
light. Sound block cues were a 2 kHz sine wave and a 8 kHz sine wave whose
amplitude was modulated from 0 to maximum by a 2 Hz sine wave. Outcome-cue
associations were counterbalanced across rats, e.g.\ for some rats L1+ was the
flashing white light, and for others L1+ was the constant yellow light. The
order of cue presentation was pseudorandomized so that the same cue could not be
presented more than twice in a row. Block order within each day was also
pseudorandomized, such that the rat could not begin a session with the same
block for more than two days in a row. Each session consisted of a 5 minute
pre-session period on a pedestal (a terracotta planter filled with towels),
followed by the first block, then the second block, then a 5 minute post-session
period on the pedestal. For approximately the first week of training, rats were restricted to
running in the clockwise direction by presenting a physical barrier to
running counterclockwise. Cues signaling the availability and
unavailability of reward, as described above, were present from the
start of training. Rats were trained for 200 trials per day (100
trials per block) until they discriminated between the reward-available and reward-unavailable cues for both light and
sound blocks for three consecutive days, according to a chi-square test
rejecting the null hypothesis of equal approaches for reward-available and
reward-unavailable trials, at which point they underwent electrode implant
surgery.

{\bf Surgery:}

Surgical procedures were as described previously
\cite{Malhotra2015}. Briefly, animals were administered analgesics and
antibiotics, anesthetized with isoflurane, induced with 5\% in medical
grade oxygen and maintained at 2\% throughout the surgery ($\sim$0.8
L/min). Rats were then chronically implanted with a ``hyperdrive''
consisting of 20 independently drivable tetrodes, with 4 designated as references tetrodes, and the remaining 16
either all targeted for the right NAc (AP +1.4 mm and ML +1.6 mm relative to
bregma; \citeNP{atlas}), or 12 in the right NAc and 4 targeted at the
mPFC (AP +3.0 mm and ML +0.6 mm, relative to bregma; only data from
NAc tetrodes was analyzed). Following surgery, all animals were given
at least five days to recover while receiving post-operative care, and
tetrodes were lowered to the target (DV -6.0 mm) before being
reintroduced to the behavioral task.

{\bf Data acquisition and preprocessing:}

After recovery, rats were placed back on the task for recording. NAc
signals were acquired at 20 kHz with a RHA2132 v0810 preamplifier
(Intan) and a KJE-1001/KJD-1000 data acquisition system
(Amplipex). Signals were referenced against a tetrode placed in the
corpus callosum above the NAc. Candidate spikes for sorting into
putative single units were obtained by band-pass filtering the data
between 600-9000 Hz, thresholding and aligning the peaks \cite[UltraMegaSort2k, ][]{Hill2011}. Spike waveforms were then
clustered with KlustaKwik using energy and the first derivative of
energy as features, and manually sorted into units (MClust 3.5,
A.D.\ Redish et al., http://redishlab.neuroscience.umn.edu/MClust/MClust.html). Isolated units containing a minimum of 200
spikes within a session were included for subsequent analysis. Units
were classified as FSIs by an absence of
interspike intervals (ISIs) $>$ 2 s, while MSNs
had a combination of ISIs $>$ 2 s and phasic activity with shorter
ISIs \cite{Barnes2005,Atallah2014}.

{\bf Data analysis:}

{\it Behavior.} To determine if rats distinguished behaviorally
between the reward-available and reward-unavailable cues ({\it cue
outcome}), we generated linear mixed effects models to investigate
the relationships between cue type and our behavioral variables, with
{\it cue outcome} (reward available or not) and {\it cue identity}
(light or sound) as fixed effects, and the addition of an intercept
for rat identity as a random effect. For each cue, the average
proportion of trials approached and trial length for a session were
used as response variables. Contribution of cue outcome to behavior
was determined by comparing the full model to a model with cue outcome
removed for each behavioral variable.

{\it Neural data.} Given that some of our analyses compare firing rates across time,
particularly comparisons across blocks, we sought to exclude units
with unstable firing rates that would generate spurious results
reflecting a drift in firing rate over time unrelated to our task. To
do this we ran a Mann-Whitney U test comparing the cue-modulated firing
rates for the first and second half of trials within a block, and
excluded 99 of 443 units from analysis that showed a significant change for
either block, leaving 344 units for further analyses by our GLM. To investigate the contribution of different cue
features ({\it cue identity}, {\it cue location} and {\it cue outcome}) on the firing rates of NAc
single units, we first determined whether firing rates for a unit
were modulated by the onset of a cue by collapsing across all cues
and comparing the firing rates for the 1 s preceding cue-onset with
the 1 s following cue-onset. Single units were considered to be {\it
cue-modulated} if a Wilcoxon signed-rank test comparing pre- and
post-cue firing was significant at $p <$ .01. Cue-modulated units
were then classified as either increasing or decreasing if the
post-cue activity was higher or lower than the pre-cue activity,
respectively.

To determine the relative contribution of different task parameters to firing rate variance (as in Figure \ref{fig:Q1}A,supplement 1), a forward selection stepwise GLM using a Poisson distribution for the response variable was fit to each cue-modulated unit, using data from every trial in a session. Cue identity (light block, sound block), cue location (arm 1, arm 2, arm 3, arm 4), cue outcome (reward-available, reward-unavailable), behavior (approach, skip), trial length, trial number, and trial history (reward availability on the previous 2 trials) were used as predictors, with firing rate as the response variable. The GLMs were fit using a sliding window for firing rate; with a bin size of 500 ms, step size of 100 ms, and an analysis window from 500 ms pre-cue-onset to 500 ms post-cue-onset, such that 11 different GLMs were fit for each unit, tracking the temporal dynamics of the influence of task parameters on firing rate around the onset of the cue. Units were classified as being modulated by a given task parameter if addition of the parameter significantly improved model fit using deviance as the criterion ($p <$ .01), and the total proportion of cue-modulated units influenced by a task parameter was counted for each time bin. A comparison of the R-squared value between the final model and the final model minus the predictor of interest was used to determine the amount of firing rate variance explained by the addition of that predictor for a given unit. To control for the amount of units that would be affected by a predictor by chance, we shuffled the trial order of firing rates for a particular unit within a time bin, ran the GLM wih the shuffled firing rates, counted the proportion of units encoding a predictor, and took the average of this value over 100 shuffles. We then calculated how many z-scores the observed proportion was from the mean of the shuffled distribution, using a z-score of greater than 1.96 as a marker of significance.

To get a sense of the predictive power of these cue feature representations we trained a classifier using firing rates from a pseudoensemble comprised of our 133 cue-modulated units (Figure \ref{fig:Q1}B). We created a matrix of firing rates for each time epoch surrounding cue-onset where each row was an observation representing the firing rate for a trial, and each column was a variable representing the firing rate for a given unit. Trial labels, or classes, were each condition for a cue feature (e.g.\ light and sound for cue identity), making sure to align trial labels across units. We then ran LDA on these matrices, using 10-fold cross validation to train the classifier on 90\% of the trials and testing its predictions on the held out 10\% of trials, and repeated this approach to get the classification accuracy for 100 iterations. To test if the classification accuracy was greater by chance, we shuffled the order of firing rates for each unit before we trained the classifier. We repeated this for 100 shuffled matrices for each time point, and calculated how many z-scores the mean classification rate of the observed data was from the mean of the shuffled distribution, using a z-score of 1.96 as the cut off for a significant deviation from the shuffled distribution.

To determine the degree to which coding of cue identity, cue location, and cue outcome overlapped within units we correlated the recoded beta coefficients from the GLMs for the cue features (Figure \ref{fig:Q1}C,D). Specifically, we generated an array for each cue feature at each point in time where for all cue-modulated units we coded a `1' if the cue feature was a significant predictor in the final model, and `0' if it was not. We then correlated an array of the coded 0s and 1s for one cue feature with a similar array for another cue feature, repeating this process for all post cue-onset sliding window combinations. The NAc was determined as coding a pair of cue features in a) separate populations of units if there was a significant negative correlation ($r < $ 0), b) an independently coded overlapping population of units if there was no significant correlation ($r = $ 0), or c) a jointly coded overlapping population of units if there was a significant positive correlation ($r > $ 0). To summarize the correlation matrices generated from this analysis, we put the output of our 100 shuffled GLMs through the same pipeline, took the mean of the 36 correlations for a block comparison for each of the 100 shuffles for an analysis window, and used the mean and standard deviation of these shuffled correlation averages to compare to the mean of the comparison block for the actual data, by generating a z-score, using a z-score of greater than 1.96 or less than -1.96 as a marker that that comparison block showed overlap across cue features greater or less than chance, respectively.

To better visualize responses to cues and enable subsequent population level analyses (as in Figures \ref{fig:examples},\ref{fig:tiling}), spike trains were convolved with a Gaussian kernel ($\sigma$ = 100 ms), and peri-event time histograms (PETHs) were generated by taking the average of the convolved spike trains across all trials for a given task condition. To visualize NAc representations of task space within cue conditions, normalized spike trains for all units were ordered by the location of their maximum or minimum firing rate for a specified cue condition (Figure \ref{fig:tiling}). To compare representations of task space across cue conditions for a cue feature, the ordering of units derived for one condition (e.g.\ light block) was then applied to the normalized spike trains for the other condition (e.g.\ sound block). To assess whether the tiling patterns were different across cue conditions, we split each cue condition into two halves, controlling for the effects of time by shuffling trial ordering before the split, and calculated the correlation of the temporally evolving smoothed firing rate across each of these halves, giving us 6 correlation values for each unit. We then concatenated these 6 values across all 443 units to give us an array of 2658 correlation coefficients. We then fit a linear mixed effects model, trying to predict these block comparison correlations with comparison type (e.g.\ 1st half of light block vs.\ 1st half of sound sound) as a fixed-effect term, and unit id as a random-effect term. Comparison type is nominal, so dummy variables were created for the various levels of comparison type, and coefficients were generated for each condition, referenced against one of the within-within comparison types (e.g.\ 1st half of light block vs.\ 2nd half of light block). Additionally, we ran a model comparison between the above model and a null model with just unit id, to see if adding comparison type improved model fit.

To identify the responsivity of units to different cue features at the time of nosepoke into a reward receptacle, and subsequent reward delivery, the same cue-modulated units from the cue-onset analyses were analyzed at the time of nosepoke and outcome receipt using identical analysis techniques for all approach trials (Figures \ref{fig:NP_examples},\ref{fig:Q2}). To compare whether coding of a given cue feature was accomplished by the same or distinct population of units across time epochs, we ran the recoded coefficient correlation that was used to assess the degree of overlap among cue features within a time epoch. All analyses were completed in MATLAB R2015a, the code is available on our public GitHub repository (http://github.com/vandermeerlab/papers), and the data can be accessed through DataLad.

{\bf Histology:}

Upon completion of the experiment, recording channels were gliosed by passing 10 $\mu A$ current for 10 seconds and waiting 5 days before euthanasia, except for rat R057 whose implant detached prematurely. Rats were anesthetized with 5\%
isoflurane, then asphyxiated with carbon dioxide. Transcardial
perfusions were performed, and brains were fixed and removed. Brains
were sliced in 50 $\mu m$ coronal sections and stained with
thionin. Slices were visualized under light microscopy, tetrode
placement was determined, and electrodes with recording locations in
the NAc were analyzed (Figure \ref{fig:histo}).

 \begin{figure}[ht!]
\centering
\includegraphics[width=\textwidth]{Fig 9 - Histology.png}
\caption*{\bsf{Figure 9:} Histological verification of recording sites. Upon completion of
  experiments, brains were sectioned and tetrode placement was
  confirmed. \bsf{A}: Example section from R060 showing a recording site in the
  NAc core just dorsal to the anterior commissure (arrow). \bsf{B}:
  Schematic showing recording areas for all subjects.}
\label{fig:histo}
\end{figure} \clearpage

\bibliography{vStrCueCoding}
\end{document}
